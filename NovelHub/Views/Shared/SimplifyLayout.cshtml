
@{
    var currentUser = (NovelHub.Models.User)HttpContext.Current.Session["User"];
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title</title>

    <!-- css -->
    <link rel="stylesheet" href="~/Contents/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="~/Contents/assets/font/fontawesome-free-6.4.0-web/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="~/Contents/assets/css/style.css">
    <link href="~/Areas/Author/Contents/css/pagination.css" rel="stylesheet" />
    <link href="~/Areas/Author/Contents/css/SimplifyLayout.css" rel="stylesheet" />
    <!-- Slick Slider Syncing -->
    <link rel="stylesheet" href="~/Contents/assets/css/slick.css">
    <link rel="stylesheet" href="~/Contents/assets/css/slick-theme.css">

    @RenderSection("css", false)

    <script src="~/Contents/assets/ckeditor/ckeditor.js"></script>
</head>
<body>

    <section id="Header" class="" style="box-shadow: 0px 10px 24px 0px rgba(0, 0, 0, 0.3);">
        <div class="container">
            <div class="row my-2">
                <div class="col-4 d-flex">
                    <a class="navbar-brand d-flex align-items-center Logo" href="~/Home/Index">
                        @*<img class="" src="https://ncomics.vercel.app/_nuxt/logo.83be12af.svg" alt="NComics">*@
                        <h3 class="">Truyen Full</h3>
                    </a>
                </div>
                <div class="col-lg-4 d-flex order-1 order-lg-0">
                    <form class="d-flex align-items-stretch rounded-pill m-2 w-100 custom-form bg-white" action="/Novel/Search" method="get">
                        <input type="text" list="datalistOptions"
                               class="w-100 py-1 border-0 ps-3 rounded-pill flex-fill" placeholder="Search"
                               style="outline: none;" name="searchString" id="searchInput" value="@ViewData["SearchString"]">
                        <button type="submit" class="px-3 border-0 rounded-pill bg-body">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </button>
                        <button onclick="startRecognition()" type="button" class="px-2 border-0 rounded-pill bg-body">
                            <i class="bi bi-mic"></i>
                        </button>
                    </form>
                    <script>
                        function startRecognition() {
                            var SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                            if (!SpeechRecognition) {
                                alert('Trình duyệt của bạn không hỗ trợ tính năng này.');
                                return;
                            }

                            var recognition = new SpeechRecognition();
                            recognition.lang = 'vi-VN';

                            recognition.onresult = function (event) {
                                var transcript = event.results[0][0].transcript.trim();
                                document.getElementById('searchInput').value = transcript;
                                search(transcript);
                            };

                            recognition.onerror = function (event) {
                                console.error(event.error);
                                alert('Đã xảy ra lỗi khi nhận diện giọng nói: ' + event.error);
                            };

                            recognition.start();
                        }

                        function search(searchString) {
                            window.location.href = '/Novel/Search?searchString=' + encodeURIComponent(searchString);
                        }
                    </script>
                    <datalist id="datalistOptions">
                        <option value="San Francisco">
                        <option value="New York">
                        <option value="Seattle">
                        <option value="Los Angeles">
                        <option value="Chicago">
                    </datalist>
                    </form>
                </div>
                <div class="col-8 col-lg-4 d-flex justify-content-end align-items-center">
                    @{
                        <a href="~/AreaUser/AUManagerProfile/UserProfile/@currentUser.UserID" class="account">
                            <i class="fa-solid fa-user"></i>
                            <span class="fw-bold">@currentUser.Username</span>
                        </a>
                        <a href="~/Account/LogOut" class="account">
                            <i class="fa-solid fa-right-from-bracket"></i>
                        </a>
                    }
                </div>
            </div>
            <div class="row my-2">
                <ul class="nav justify-content-center">
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" href="~/Home/Index">
                            <i class="fa-solid fa-house"></i>
                            <span>Home</span>
                        </a>
                    </li>
                    <li class="nav-item dropdown Category">
                        <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button"
                           aria-expanded="false">
                            <i class="bi bi-tags-fill"></i>
                            Thể Loại
                        </a>
                        <ul class="dropdown-menu Dropdown-Menu text-center">
                            <div class="container">
                                <div class="row gx-0" id="ListCategories">
                                    <div class="col-6 col-sm-4">
                                        <a href="#" class="Category-Link d-block w-100 h-100 py-2">Huyền Huyễn</a>
                                    </div>
                                    <div class="col-6 col-sm-4">
                                        <a href="#" class="Category-Link d-block w-100 h-100 py-2">Tất cả</a>
                                    </div>
                                </div>
                            
                                <script>
                                    var url = '/Category/RenderAllCategories';
                                    fetch(url, {
                                        method: 'GET',
                                        headers: {
                                            'Content-Type': 'application/json'
                                        },
                                    })
                                    .then(response => response.json())
                                    .then(data => {
                                        var html = '';
                                        data.forEach(element => {
                                            html += `
                                            <div class="col-6 col-sm-4">
                                                <a href="/Novel/FindByCategory?categoryID=${element.CategoryID}" class="Category-Link d-block w-100 h-100 py-2">${element.CategoryName}</a>
                                            </div>
                                        `;
                                        });
                                        html += `
                                            <div class="col-6 col-sm-4">
                                                <a href="/Novel/FilterNovels" class="Category-Link d-block w-100 h-100 py-2">Tất cả</a>
                                            </div>
                                        `
                                        // Đặt HTML vào ListCategories
                                        document.getElementById('ListCategories').innerHTML = html;
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                                </script>
                            </div>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="~/Novel/FilterNovels">
                            <i class="fa-solid fa-filter"></i>
                            <span>Bộ Lọc</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </section>
    <section id="Navigation">
        <input type="checkbox" hidden id="Bar">
        <label for="Bar" class="cursorPointer fixed-top p-3" style="width: 50px;"><i class="fa-solid fa-bars-progress">Home</i></label>
    </section>

    <script>
        // js header
        var chkBar = document.querySelector('#Navigation #Bar');
        var labelChekBar = document.querySelector('#Navigation label');
        var header = document.querySelector('#Header');
        chkBar.addEventListener('change', function () {
            if (this.checked) {
                header.classList.add('bg-white')
                header.style.top = '0';
            } else {
                header.style.top = '-100%';
            }
        })

        document.addEventListener('click', function (event) {
            if (!header.contains(event.target) && !chkBar.contains(event.target) && !labelChekBar.contains(event.target)) {
                header.style.top = '-100%';
                chkBar.checked = false;
            }
        });

        var Links = document.querySelectorAll('#Header a');
        Links.forEach(link => {
            link.addEventListener('click', function () {
                chkBar.checked = false;
            });
        });


    </script>

    <section id="Main" class="my-5" style="min-height: 70vh">
        <div class="container">
            <div class="row g-1">
                <div class="col-lg-3 SideBar position-relative">
                    <div class="cursorPointer d-lg-none d-block barBtn">
                        <input type="checkbox" hidden id="checkNavBar">
                        <label for="checkNavBar" class="p-2 checkNavBarLabel">
                            <i class="fa-solid fa-bars">Action</i>
                        </label>
                    </div>
                    <ul class="nav flex-column d-none d-lg-block Navigation w-100">
                        @{
                            switch (currentUser.RoleID)
                            {
                                case 1:
                                    <li class="nav-item">
                                        <a href="~/AreaUser/AUManagerProfile/UserProfile/@currentUser.UserID" class="nav-link"><i class="fa-solid fa-user"></i> Cá Nhân</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="~/AreaUser/AUManagerProfile/FollowedNovels" class="nav-link"><i class="fa-solid fa-bookmark"></i> Truyện Yêu Thích</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="~/Author/AuthorNovels/PublishNovel" class="nav-link"><i class="fa-solid fa-upload"></i> Đăng Truyện</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="~/Author/AuthorNovels/PublishedNovel" class="nav-link"><i class="fa-solid fa-book-journal-whills"></i> Truyện Đã Đăng</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="~/Author/AuthorChapters/ManagerChapters" class="nav-link"><i class="fa-regular fa-rectangle-list"></i> Quản Lý Chương</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="~/Admin/AdminNovels/ManagerNovels" class="nav-link"><i class="fa-solid fa-swatchbook"></i> Quản Lý Truyện</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="~/Admin/AdminUsers/ManagerUsers" class="nav-link"><i class="fa-solid fa-people-roof"></i> Quản Lý Người Dùng</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="~/Admin/AdminCategories/ManagerCategories" class="nav-link"><i class="fa-solid fa-earth-americas"></i> Quản Lý Thể Loại</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="~/Admin/Notifications/Index" class="nav-link"><i class="fa-solid fa-earth-americas"></i> Quản Lý Thông Báo <span class="text-danger" id="countNotification"></span></a>
                                    </li>
                                    break;
                                case 2:
                                    <li class="nav-item">
                                        <a href="~/AreaUser/AUManagerProfile/UserProfile/@currentUser.UserID" class="nav-link"><i class="fa-solid fa-user"></i> Cá Nhân</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="~/AreaUser/AUManagerProfile/FollowedNovels" class="nav-link"><i class="fa-solid fa-bookmark"></i> Truyện Yêu Thích</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="~/Author/AuthorNovels/PublishNovel" class="nav-link"><i class="fa-solid fa-upload"></i> Đăng Truyện</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="~/Author/AuthorNovels/PublishedNovel" class="nav-link"><i class="fa-solid fa-book-journal-whills"></i> Truyện Đã Đăng</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="~/Author/AuthorChapters/ManagerChapters" class="nav-link"><i class="fa-regular fa-rectangle-list"></i> Quản Lý Chương</a>
                                    </li>
                                    break;
                                default:
                                    <li class="nav-item">
                                        <a href="~/AreaUser/AUManagerProfile/UserProfile/@currentUser.UserID" class="nav-link"><i class="fa-solid fa-user"></i> Cá nhân</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="~/AreaUser/AUManagerProfile/FollowedNovels" class="nav-link"><i class="fa-solid fa-bookmark"></i> Truyện Yêu Thích</a>
                                    </li>
                                    break;
                            }
                        }

                    </ul>
                </div>
                <script>
                    // js navbar
                    var checkNavBar = document.querySelector('#Main .barBtn #checkNavBar');
                    var labelcheckbox = document.querySelector('#Main .barBtn .checkNavBarLabel');
                    var nav = document.querySelector('#Main .Navigation');
                    checkNavBar.addEventListener('change', function () {
                        if (checkNavBar.checked) {
                            nav.classList.remove('d-none');
                            nav.classList.add('position-absolute');
                            nav.style = 'z-index: 1; background-color: #fff; border: solid 1px var(--primaty-color); box-shadow: 0 0 4px var(--primaty-color);'
                        } else {
                            nav.classList.add('d-none');
                            nav.classList.remove('position-absolute');
                            nav.removeAttribute('style');
                        }
                    })
                    document.addEventListener('click', function (event) {
                        if (!checkNavBar.contains(event.target) && !labelcheckbox.contains(event.target) && !nav.contains(event.target)) {
                            checkNavBar.checked = false;
                            nav.classList.add('d-none');
                            nav.classList.remove('position-absolute');
                            nav.removeAttribute('style');
                        }
                    })
                </script>
                @RenderBody()
            </div>
        </div>
    </section>

    <section id="Footer" class="mt-5 bg-white">
        <hr />
        <div class="container py-3">

            <div class="row">
                <div class="col-5">
                    <p>
                        <strong>Truyện Full</strong> - Đọc truyện online, đọc truyện chữ, truyện hay. Website luôn cập nhật những bộ truyện mới thuộc các thể loại đặc sắc như truyện tiên hiệp, truyện kiếm hiệp, hay truyện ngôn tình một cách nhanh nhất. Hỗ trợ mọi thiết bị như di động và máy tính bảng.
                    </p>
                    <a href="#" class="d-block">
                        <img src="https://i.creativecommons.org/l/by/4.0/88x31.png" width="100" height="50" class="object-fit-contain" />
                    </a>
                </div>
                <div class="col-7">
                    <div class="d-flex flex-wrap">
                        <div class="m-2"><a href="#" class="btn btn-dark text-white">Huyền Huyễn</a></div>
                        <div class="m-2"><a href="#" class="btn btn-dark text-white">Tâm Lý</a></div>
                        <div class="m-2"><a href="#" class="btn btn-dark text-white">Tiên Hiệp</a></div>
                        <div class="m-2"><a href="#" class="btn btn-dark text-white">Ngôn Tình</a></div>
                        <div class="m-2"><a href="#" class="btn btn-dark text-white">Lịch Sử</a></div>
                        <div class="m-2"><a href="#" class="btn btn-dark text-white">Đồng Nhân</a></div>
                        <div class="m-2"><a href="#" class="btn btn-dark text-white">Du Hí</a></div>
                        <div class="m-2"><a href="#" class="btn btn-dark text-white">Quân Sự</a></div>
                        <div class="m-2"><a href="#" class="btn btn-dark text-white">Khoa Học</a></div>
                        <div class="m-2"><a href="#" class="btn btn-dark text-white">Kinh Dị</a></div>

                    </div>

                </div>
            </div>

        </div>

    </section>

    <section id="Modal">

        <section>
            <!-- Mess success -->
            <button type="button" class="btn btn-primary" hidden id="liveToastBtn">ShowMessage</button>

            <div class="toast-container position-fixed bottom-0 end-0 p-3">
                <div id="liveToast" class="toast bg-white" role="alert" aria-live="assertive" aria-atomic="true" style="border: solid 2px @TempData["Color"];">
                    <div class="toast-header">
                        <strong class="me-auto" style="color: @TempData["Color"]">Thông báo</strong>
                        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                    <div class="toast-body">
                        @TempData["ToastContent"]
                    </div>
                </div>
            </div>
        </section>

        @RenderSection("modal", false)
    </section>

    <!-- js -->
    <script src="~/Contents/assets/js/bootstrap.bundle.min.js"></script>
    <script src="~/Contents/assets/ckeditor/ckeditor.js"></script>
    <script src="~/Contents/assets/js/jquery-3.6.0.min.js"></script>
    <script src="~/Contents/assets/js/pagination.js"></script>
    <script src="~/Contents/assets/js/app.js"></script>

    @RenderSection("script", false)

    <!-- js Toast-->
    <script>
        const toastTrigger = document.getElementById('liveToastBtn')
        const toastLiveExample = document.getElementById('liveToast')

        if (toastTrigger) {
            const toastBootstrap = bootstrap.Toast.getOrCreateInstance(toastLiveExample)
            toastTrigger.addEventListener('click', () => {
                toastBootstrap.show()
            })
        }
    </script>

    <!-- Active Toast-->
    @if (TempData["ActiveToast"] != null)
    {
        <script>
            document.getElementById("liveToastBtn").click();
        </script>
    }
    <script>
        $(document).ready(function () {
            $.ajax({
                url: "/Admin/Notifications/CountReadStatusFalse", // Thay đổi URL dựa trên địa chỉ thực tế của ứng dụng web của bạn và tên controller của bạn
                type: "GET",
                success: function (data) {
                    var html = `(${data})`;
                    $("#countNotification").html(html);
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.error("Failed to call the API: " + textStatus, errorThrown);
                }
            });
        });

    </script>

</body>
</html>
